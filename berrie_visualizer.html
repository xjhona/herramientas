<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planificador de Cultivo de Arándanos</title>
    
    <!-- Librerías necesarias (React, Babel, Tailwind) -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8fafc; }
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #7c3aed; cursor: pointer; margin-top: -6px; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #e2e8f0; border-radius: 2px; }
    </style>
</head>
<body>
    <div id="root" class="h-screen flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // --- ICONOS SVG ---
        const Icon = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const SettingsIcon = () => <Icon><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.09a2 2 0 0 1-1-1.74v-.47a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.39a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></Icon>;
        const SproutIcon = () => <Icon><path d="M7 20h10"/><path d="M10 20c5.5-2.5.8-6.4 3-10"/><path d="M9.5 9.4c1.1.8 1.8 2.2 2.3 3.7-2 .4-3.2.4-4.8-.4-1.2-.6-2.1-2.2-2.1-2.2 0 0 1.8-1.3 4.6-1.1Z"/></Icon>;
        const LeafIcon = () => <Icon><path d="M11 20A7 7 0 0 1 9.8 6.1C15.5 5 17 4.48 19 2c1 2 2 6.5-2 12A7 7 0 0 1 11 20Z"/><path d="M8 21h4"/><path d="M7 2a11.9 11.9 0 0 0-2 19"/></Icon>;
        const MaximizeIcon = () => <Icon><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></Icon>;
        const LayoutIcon = () => <Icon><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="9" x2="9" y1="21" y2="9"/></Icon>;
        const WindIcon = () => <Icon><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></Icon>;
        const ZoomInIcon = () => <Icon><circle cx="11" cy="11" r="8"/><line x1="21" x2="16.65" y1="21" y2="16.65"/><line x1="11" x2="11" y1="8" y2="14"/><line x1="8" x2="14" y1="11" y2="11"/></Icon>;
        const ZoomOutIcon = () => <Icon><circle cx="11" cy="11" r="8"/><line x1="21" x2="16.65" y1="21" y2="16.65"/><line x1="8" x2="14" y1="11" y2="11"/></Icon>;

        // --- COMPONENTE PRINCIPAL ---
        const BlueberryPlanner = () => {
            const [params, setParams] = useState({
                distPlantas: 0.75,
                distHileras: 2.20,
                distCortina: 1.10,
                anchoCalle: 4.00,
                largoLote: 100,
                anchoLote: 100,
                areaTotal: 1,
                hilerasPorBloque: 8
            });

            const [zoom, setZoom] = useState(35);
            const canvasRef = useRef(null);
            const containerRef = useRef(null);
            const appRef = useRef(null);

            // Cálculos
            const stats = useMemo(() => {
                const hilerasBloque = Math.max(1, params.hilerasPorBloque);
                const dHileras = Math.max(0.1, params.distHileras);
                const dPlantas = Math.max(0.1, params.distPlantas);

                const espaciosEntreHileras = hilerasBloque - 1;
                const anchoTotalBloque = (dHileras * espaciosEntreHileras) + params.anchoCalle;
                const distPromedioHileras = anchoTotalBloque / hilerasBloque;
                
                const areaPorPlanta = distPromedioHileras * dPlantas;
                const plantasPorHa = areaPorPlanta > 0 ? Math.floor(10000 / areaPorPlanta) : 0;
                const totalPlantas = Math.floor(plantasPorHa * params.areaTotal);
                
                return {
                    plantasPorHa,
                    totalPlantas,
                    distPromedioHileras: distPromedioHileras.toFixed(2)
                };
            }, [params]);

            const handleChange = (e) => {
                const { name, value } = e.target;
                setParams(prev => ({ ...prev, [name]: value === '' ? 0 : parseFloat(value) }));
            };

            const handleZoom = (delta) => {
                setZoom(prev => Math.min(Math.max(prev + delta, 15), 100));
            };

            const draw = () => {
                const canvas = canvasRef.current;
                const container = containerRef.current;
                if (!canvas || !container) return;

                const ctx = canvas.getContext('2d');
                const dpr = window.devicePixelRatio || 1;
                const rect = container.getBoundingClientRect();
                
                canvas.width = rect.width * dpr;
                canvas.height = rect.height * dpr;
                ctx.scale(dpr, dpr);
                canvas.style.width = `${rect.width}px`;
                canvas.style.height = `${rect.height}px`;

                const width = rect.width;
                const height = rect.height;

                // Limpiar
                ctx.clearRect(0, 0, width, height);
                
                // Fondo
                const gradient = ctx.createLinearGradient(0, 0, 0, height);
                gradient.addColorStop(0, '#f0f4f8'); 
                gradient.addColorStop(1, '#ffffff');
                ctx.fillStyle = gradient;
                ctx.fillRect(0, 0, width, height);

                // --- PROTECCIÓN CRÍTICA ---
                if (params.distPlantas < 0.1 || params.distHileras < 0.1) {
                    ctx.fillStyle = "#94a3b8";
                    ctx.font = "14px sans-serif";
                    ctx.fillText("Ingrese valores válidos...", 20, 30);
                    return; 
                }

                // Isométrico
                const isoX = (x, y) => (x - y) * Math.cos(Math.PI / 6);
                const isoY = (x, y) => (x + y) * Math.sin(Math.PI / 6);

                const centerX = width / 2;
                const centerY = height / 5;
                const scale = zoom;

                const drawElement = (x, y, type) => {
                    const screenX = centerX + isoX(x * scale, y * scale);
                    const screenY = centerY + isoY(x * scale, y * scale);
                    if (screenX < -100 || screenX > width + 100 || screenY < -100 || screenY > height + 100) return;

                    ctx.save();
                    ctx.translate(screenX, screenY);
                    const elementScale = Math.max(0.6, scale / 35); 

                    if (type === 'pot') {
                        ctx.scale(elementScale, elementScale);
                        // Sombra
                        ctx.fillStyle = 'rgba(0,0,0,0.15)';
                        ctx.beginPath(); ctx.ellipse(0, 4, 8, 4, 0, 0, 2 * Math.PI); ctx.fill();
                        // Maceta
                        ctx.fillStyle = '#5D4037'; 
                        ctx.beginPath(); ctx.moveTo(-6, 0); ctx.lineTo(6, 0); ctx.lineTo(4.5, 9); ctx.lineTo(-4.5, 9); ctx.closePath(); ctx.fill();
                        ctx.fillStyle = '#3E2723';
                        ctx.beginPath(); ctx.ellipse(0, 0, 6, 2.5, 0, 0, 2 * Math.PI); ctx.fill();
                        // Arbusto
                        ctx.fillStyle = '#1B5E20'; 
                        ctx.beginPath(); ctx.arc(-3, -6, 6, 0, 2 * Math.PI); ctx.fill();
                        ctx.beginPath(); ctx.arc(3, -6, 6, 0, 2 * Math.PI); ctx.fill();
                        ctx.beginPath(); ctx.arc(0, -9, 7, 0, 2 * Math.PI); ctx.fill();
                        ctx.fillStyle = '#2E7D32'; 
                        ctx.beginPath(); ctx.arc(-2, -8, 5, 0, 2 * Math.PI); ctx.fill();
                        ctx.beginPath(); ctx.arc(2, -8, 5, 0, 2 * Math.PI); ctx.fill();
                        ctx.beginPath(); ctx.arc(0, -11, 5, 0, 2 * Math.PI); ctx.fill();
                        // Frutos
                        ctx.fillStyle = '#3F51B5'; 
                        const berries = [{x:-2, y:-6}, {x:2, y:-10}, {x:4, y:-5}, {x:-3, y:-11}, {x:0, y:-7}];
                        berries.forEach(b => {
                            ctx.beginPath(); ctx.arc(b.x, b.y, 1.8, 0, 2 * Math.PI); ctx.fill();
                            ctx.fillStyle = '#9FA8DA';
                            ctx.beginPath(); ctx.arc(b.x - 0.5, b.y - 0.5, 0.5, 0, 2 * Math.PI); ctx.fill();
                            ctx.fillStyle = '#3F51B5'; 
                        });
                    } else if (type === 'mesh') {
                        ctx.scale(elementScale, elementScale);
                        const postHeight = 45;
                        // Sombra
                        ctx.fillStyle = 'rgba(0,0,0,0.2)';
                        ctx.beginPath(); ctx.ellipse(2, 0, 4, 2, 0, 0, 2 * Math.PI); ctx.fill();
                        // Poste
                        ctx.fillStyle = '#607D8B'; 
                        ctx.fillRect(-2, -postHeight, 4, postHeight);
                        // Malla
                        const nextPostY = 25; const nextPostX = -14; 
                        ctx.fillStyle = 'rgba(30, 30, 30, 0.6)'; 
                        ctx.beginPath(); ctx.moveTo(0, -postHeight); ctx.lineTo(0, 0); ctx.lineTo(nextPostX, nextPostY); ctx.lineTo(nextPostX, nextPostY - postHeight); ctx.closePath(); ctx.fill();
                        // Red
                        ctx.strokeStyle = 'rgba(255,255,255,0.3)'; ctx.lineWidth = 1;
                        ctx.beginPath();
                        ctx.moveTo(0, -postHeight); ctx.lineTo(nextPostX, nextPostY - 20);
                        ctx.moveTo(0, -postHeight + 15); ctx.lineTo(nextPostX, nextPostY - 5);
                        ctx.moveTo(0, -postHeight + 30); ctx.lineTo(nextPostX, nextPostY + 10);
                        ctx.moveTo(nextPostX, nextPostY - postHeight); ctx.lineTo(0, -20);
                        ctx.moveTo(nextPostX, nextPostY - postHeight + 15); ctx.lineTo(0, -5);
                        ctx.stroke();
                    }
                    ctx.restore();
                };

                const viewWidthMeters = 24 * (35/zoom); 
                const viewDepthMeters = 24 * (35/zoom);

                // Cortina
                for (let y = 0; y < viewDepthMeters; y += 2) {
                    drawElement(-params.distCortina, y, 'mesh');
                }
                const labelX = centerX + isoX(-params.distCortina * scale, 0);
                const labelY = centerY + isoY(-params.distCortina * scale, 0) - (60 * (scale/35));
                ctx.fillStyle = '#333';
                ctx.font = `bold ${Math.max(10, 12 * (scale/35))}px sans-serif`;
                ctx.fillText("Malla Cortaviento", labelX - 40, labelY);

                // Plantas y Calles
                let currentX = 0;
                let hileraCount = 0;

                while (currentX < viewWidthMeters) {
                    if (hileraCount > 0 && hileraCount % params.hilerasPorBloque === 0) {
                        const streetStartX = currentX - (params.distHileras/2);
                        const streetCenterX = streetStartX + (params.anchoCalle/2);
                        const p1 = { x: streetCenterX - params.anchoCalle/2, y: 0 };
                        const p2 = { x: streetCenterX + params.anchoCalle/2, y: 0 };
                        const p3 = { x: streetCenterX + params.anchoCalle/2, y: viewDepthMeters };
                        const p4 = { x: streetCenterX - params.anchoCalle/2, y: viewDepthMeters };

                        ctx.beginPath();
                        ctx.moveTo(centerX + isoX(p1.x*scale, p1.y*scale), centerY + isoY(p1.x*scale, p1.y*scale));
                        ctx.lineTo(centerX + isoX(p2.x*scale, p2.y*scale), centerY + isoY(p2.x*scale, p2.y*scale));
                        ctx.lineTo(centerX + isoX(p3.x*scale, p3.y*scale), centerY + isoY(p3.x*scale, p3.y*scale));
                        ctx.lineTo(centerX + isoX(p4.x*scale, p4.y*scale), centerY + isoY(p4.x*scale, p4.y*scale));
                        ctx.closePath();
                        ctx.fillStyle = 'rgba(210, 180, 140, 0.3)'; ctx.fill();
                        ctx.strokeStyle = 'rgba(210, 180, 140, 0.8)'; ctx.stroke();

                        if (currentX < viewWidthMeters) {
                            const sX = centerX + isoX(streetCenterX * scale, viewDepthMeters/2 * scale);
                            const sY = centerY + isoY(streetCenterX * scale, viewDepthMeters/2 * scale);
                            ctx.fillStyle = '#8D6E63';
                            ctx.font = `italic ${Math.max(9, 11 * (scale/35))}px sans-serif`;
                            ctx.fillText(`Calle`, sX - 20, sY);
                            ctx.fillText(`(${params.anchoCalle}m)`, sX - 15, sY + 12);
                        }
                        currentX += params.anchoCalle - params.distHileras;
                        hileraCount = 0;
                    } else {
                        for (let y = 0; y < viewDepthMeters; y += params.distPlantas) {
                            drawElement(currentX, y, 'pot');
                        }
                    }
                    currentX += params.distHileras;
                    hileraCount++;
                }

                // Cotas
                const fontSize = Math.max(9, 11 * (scale/35));
                ctx.font = `bold ${fontSize}px sans-serif`;

                const pStart = { x: centerX + isoX(0,0), y: centerY + isoY(0,0)};
                const pEnd = { x: centerX + isoX(0, params.distPlantas*scale), y: centerY + isoY(0, params.distPlantas*scale)};
                ctx.strokeStyle = '#E91E63'; ctx.lineWidth = 2;
                ctx.beginPath(); ctx.moveTo(pStart.x + 20, pStart.y); ctx.lineTo(pEnd.x + 20, pEnd.y); ctx.stroke();
                ctx.fillStyle = '#E91E63'; ctx.fillText(`${params.distPlantas}m`, pEnd.x + 25, pEnd.y - 5);

                const hStart = { x: centerX + isoX(0,0), y: centerY + isoY(0,0)};
                const hEnd = { x: centerX + isoX(params.distHileras*scale, 0), y: centerY + isoY(params.distHileras*scale, 0)};
                ctx.strokeStyle = '#2196F3';
                ctx.beginPath(); ctx.moveTo(hStart.x, hStart.y + 15); ctx.lineTo(hEnd.x, hEnd.y + 15); ctx.stroke();
                ctx.fillStyle = '#2196F3'; ctx.fillText(`${params.distHileras}m`, hStart.x + (hEnd.x - hStart.x)/2 - 10, hStart.y + 30);
            };

            useEffect(() => {
                const timeoutId = setTimeout(() => draw(), 50);
                return () => clearTimeout(timeoutId);
            }, [params, zoom]);

            useEffect(() => {
                const handleResize = () => window.requestAnimationFrame(draw);
                window.addEventListener('resize', handleResize);
                handleResize();
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            return (
                <div ref={appRef} className="flex flex-col h-full bg-slate-50 text-slate-800">
                    {/* Header Resumen */}
                    <div className="bg-white p-4 shadow-sm border-b border-slate-200 grid grid-cols-1 md:grid-cols-3 gap-4 flex-shrink-0">
                        <div className="flex items-center space-x-3 p-3 bg-purple-50 rounded-lg border border-purple-100">
                            <div className="bg-purple-600 text-white p-2 rounded-full"><SproutIcon /></div>
                            <div>
                                <p className="text-xs text-purple-800 font-semibold uppercase">Total Plantas</p>
                                <p className="text-xl md:text-2xl font-bold text-purple-900">{stats.totalPlantas.toLocaleString()}</p>
                            </div>
                        </div>
                        <div className="flex items-center space-x-3 p-3 bg-green-50 rounded-lg border border-green-100">
                            <div className="bg-green-600 text-white p-2 rounded-full"><LeafIcon /></div>
                            <div>
                                <p className="text-xs text-green-800 font-semibold uppercase">Densidad (Pl/Ha)</p>
                                <p className="text-xl md:text-2xl font-bold text-green-900">{stats.plantasPorHa.toLocaleString()}</p>
                            </div>
                        </div>
                        <div className="flex items-center p-3 bg-blue-50 rounded-lg border border-blue-100">
                            <div className="flex items-center space-x-3">
                                <div className="bg-blue-600 text-white p-2 rounded-full"><MaximizeIcon /></div>
                                <div>
                                    <p className="text-xs text-blue-800 font-semibold uppercase">Distancia entre hilera promedio</p>
                                    <p className="text-xl md:text-2xl font-bold text-blue-900">{stats.distPromedioHileras}m</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="flex flex-col lg:flex-row flex-1 overflow-hidden">
                        {/* Panel de Control */}
                        <div className="w-full lg:w-80 bg-white shadow-md z-10 overflow-y-auto border-r border-slate-200 flex-shrink-0">
                            <div className="p-4 bg-purple-900 text-white flex items-center gap-2 sticky top-0 z-10">
                                <SettingsIcon />
                                <h2 className="font-bold">Parámetros</h2>
                            </div>
                            <div className="p-6 space-y-6">
                                {/* Grupo 1 */}
                                <div className="space-y-4">
                                    <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider border-b pb-1">Marco de Plantación</h3>
                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-700 flex justify-between">Entre Plantas (m)</label>
                                        <div className="flex gap-2">
                                            <input type="number" name="distPlantas" min="0.10" max="3.00" step="0.01" value={params.distPlantas === 0 ? '' : params.distPlantas} onChange={handleChange} className="w-20 p-1 border border-slate-300 rounded text-center font-bold text-purple-700 focus:ring-2 focus:ring-purple-500 outline-none" />
                                            <input type="range" name="distPlantas" min="0.2" max="2.0" step="0.01" value={params.distPlantas || 0.75} onChange={handleChange} className="flex-1 h-8 bg-slate-200 rounded-lg accent-purple-600 align-middle" />
                                        </div>
                                    </div>
                                    <div className="space-y-2">
                                        <label className="text-sm font-medium text-slate-700 flex justify-between">Entre Hileras (m)</label>
                                        <div className="flex gap-2">
                                            <input type="number" name="distHileras" min="0.50" max="5.00" step="0.01" value={params.distHileras === 0 ? '' : params.distHileras} onChange={handleChange} className="w-20 p-1 border border-slate-300 rounded text-center font-bold text-purple-700 focus:ring-2 focus:ring-purple-500 outline-none" />
                                            <input type="range" name="distHileras" min="1.0" max="4.0" step="0.01" value={params.distHileras || 2.20} onChange={handleChange} className="flex-1 h-8 bg-slate-200 rounded-lg accent-purple-600" />
                                        </div>
                                    </div>
                                </div>
                                {/* Grupo 2 */}
                                <div className="space-y-4">
                                    <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider border-b pb-1">Estructura del Lote</h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div className="space-y-1">
                                            <label className="text-xs font-medium text-slate-600">Cortina (m)</label>
                                            <div className="flex items-center border rounded px-2 bg-slate-50">
                                                <WindIcon className="text-slate-400 mr-2" />
                                                <input type="number" name="distCortina" step="0.01" value={params.distCortina === 0 ? '' : params.distCortina} onChange={handleChange} className="w-full py-1 bg-transparent outline-none text-sm" />
                                            </div>
                                        </div>
                                        <div className="space-y-1">
                                            <label className="text-xs font-medium text-slate-600">Ancho Calle (m)</label>
                                            <div className="flex items-center border rounded px-2 bg-slate-50">
                                                <LayoutIcon className="text-slate-400 mr-2" />
                                                <input type="number" name="anchoCalle" step="0.01" value={params.anchoCalle === 0 ? '' : params.anchoCalle} onChange={handleChange} className="w-full py-1 bg-transparent outline-none text-sm" />
                                            </div>
                                        </div>
                                    </div>
                                    <div className="space-y-2 pt-2">
                                        <label className="text-sm font-medium text-slate-700">Frecuencia de Calle</label>
                                        <div className="flex items-center justify-between text-xs text-slate-500 mb-1">
                                            <span>Cada {params.hilerasPorBloque} hileras</span>
                                        </div>
                                        <input type="range" name="hilerasPorBloque" min="2" max="20" step="1" value={params.hilerasPorBloque} onChange={handleChange} className="w-full h-2 bg-slate-200 rounded-lg cursor-pointer accent-orange-500" />
                                    </div>
                                </div>
                                {/* Grupo 3 */}
                                <div className="space-y-4">
                                    <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider border-b pb-1">Proyecto</h3>
                                    <div className="space-y-1">
                                        <label className="text-sm font-medium text-slate-700">Área Total (Hectáreas)</label>
                                        <input type="number" name="areaTotal" step="0.01" value={params.areaTotal} onChange={handleChange} className="w-full p-2 border border-slate-300 rounded focus:ring-2 focus:ring-purple-500 outline-none" />
                                    </div>
                                </div>
                                <div className="bg-blue-50 p-3 rounded text-xs text-blue-800 border border-blue-200">
                                    <p><strong>Cálculo:</strong> Se usa el distanciamiento promedio: <em>(({params.distHileras || 0} * {params.hilerasPorBloque - 1}) + {params.anchoCalle || 0}) / {params.hilerasPorBloque} = {stats.distPromedioHileras}m</em></p>
                                </div>
                                {/* Footer Credits */}
                                <div className="mt-4 text-center">
                                    <span className="text-[10px] text-slate-400 font-mono">Vibe-coded by jchilet</span>
                                </div>
                            </div>
                        </div>

                        {/* Visualización */}
                        <div ref={containerRef} className="flex-1 bg-slate-100 relative overflow-hidden flex items-center justify-center p-0">
                            <div className="absolute top-4 left-4 z-10 bg-white/80 backdrop-blur px-3 py-1 rounded-full text-xs font-bold text-slate-500 border border-slate-200 shadow-sm pointer-events-none">
                                Vista Isométrica Interactiva
                            </div>
                            <div className="absolute top-4 right-4 z-20 flex flex-col gap-2">
                                <button onClick={() => handleZoom(5)} className="bg-white p-2 rounded-lg shadow-md hover:bg-slate-50 border border-slate-200 text-slate-600 transition-colors" title="Acercar">
                                    <ZoomInIcon />
                                </button>
                                <button onClick={() => handleZoom(-5)} className="bg-white p-2 rounded-lg shadow-md hover:bg-slate-50 border border-slate-200 text-slate-600 transition-colors" title="Alejar">
                                    <ZoomOutIcon />
                                </button>
                            </div>
                            
                            <canvas ref={canvasRef} className="block shadow-md bg-white" style={{ maxWidth: '100%', maxHeight: '100%' }} />

                            <div className="absolute bottom-6 right-6 bg-white/90 backdrop-blur p-3 rounded-lg shadow-lg border border-slate-200 text-xs space-y-2 pointer-events-none z-10">
                                <div className="flex items-center gap-2"><div className="w-3 h-3 rounded-full bg-[#1B5E20]"></div><span>Arándano en Maceta</span></div>
                                <div className="flex items-center gap-2"><div className="w-3 h-3 bg-[#607D8B] border border-black"></div><span>Malla Cortaviento</span></div>
                                <div className="flex items-center gap-2"><div className="w-3 h-3 bg-[rgba(210,180,140,0.8)] border border-yellow-600"></div><span>Calle</span></div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BlueberryPlanner />);
    </script>
</body>
</html>
